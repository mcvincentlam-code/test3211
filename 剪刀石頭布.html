<script>
  const choices = ["å‰ªåˆ€", "çŸ³é ­", "å¸ƒ"];
  const emojis = { "å‰ªåˆ€": "âœŒï¸", "çŸ³é ­": "âœŠ", "å¸ƒ": "ğŸ–ï¸" };

  let totalRounds = 0;
  let currentRound = 0;
  let win = 0;
  let lose = 0;
  let draw = 0;
  let currentStreak = 0;
  let maxStreak = 0;
  let loseStreak = 0;
  let maxLoseStreak = 0;

  function startGame() {
    const input = document.getElementById("roundsInput").value;
    totalRounds = parseInt(input);
    if (isNaN(totalRounds) || totalRounds <= 0) {
      alert("è«‹è¼¸å…¥æ­£ç¢ºçš„å±€æ•¸ï¼");
      return;
    }

    // åˆå§‹åŒ–æ‰€æœ‰çµ±è¨ˆ
    currentRound = win = lose = draw = currentStreak = maxStreak = loseStreak = maxLoseStreak = 0;

    document.getElementById("setup").classList.add("hidden");
    document.getElementById("game").classList.remove("hidden");
    document.getElementById("finalResult").classList.add("hidden");
    document.getElementById("roundResult").innerText = "";
    updateRoundCount();
  }

  function playRound(playerChoice) {
    if (currentRound >= totalRounds) return;

    const computerChoice = choices[Math.floor(Math.random() * 3)];
    let resultText = `ä½ å‡ºï¼š${playerChoice} ${emojis[playerChoice]}<br>é›»è…¦å‡ºï¼š${computerChoice} ${emojis[computerChoice]}<br>`;

    if (playerChoice === computerChoice) {
      resultText += "çµæœï¼šå¹³æ‰‹ï¼";
      draw++;
      // å¹³æ‰‹ä¸å½±éŸ¿é€£å‹ç´€éŒ„
    } else if (
      (playerChoice === "å‰ªåˆ€" && computerChoice === "å¸ƒ") ||
      (playerChoice === "çŸ³é ­" && computerChoice === "å‰ªåˆ€") ||
      (playerChoice === "å¸ƒ" && computerChoice === "çŸ³é ­")
    ) {
      resultText += "çµæœï¼šä½ è´äº†ï¼ğŸ‰";
      win++;
      currentStreak++;
      maxStreak = Math.max(maxStreak, currentStreak);
      loseStreak = 0;  // æ–·é–‹é€£æ•—
    } else {
      resultText += "çµæœï¼šä½ è¼¸äº†ï¼ğŸ’¥";
      lose++;
      loseStreak++;
      maxLoseStreak = Math.max(maxLoseStreak, loseStreak);
      currentStreak = 0;  // æ–·é–‹é€£å‹
    }

    currentRound++;
    document.getElementById("roundResult").innerHTML = resultText;
    updateRoundCount();

    if (currentRound >= totalRounds) {
      endGame();
    }
  }

  function updateRoundCount() {
    document.getElementById("roundCount").innerText = `ç¬¬ ${currentRound} / ${totalRounds} å±€`;
  }

  function endGame() {
    document.getElementById("game").classList.add("hidden");
    const resultHTML = `
      ğŸ¯ éŠæˆ²çµæŸï¼<br><br>
      âœ… å‹åˆ©å±€æ•¸ï¼š${win}<br>
      âŒ è½æ•—å±€æ•¸ï¼š${lose}<br>
      ğŸ˜ å¹³æ‰‹å±€æ•¸ï¼š${draw}<br><br>
      ğŸ”¥ ç•¶å‰é€£å‹ï¼š${currentStreak}<br>
      ğŸ† æœ€é«˜é€£å‹ç´€éŒ„ï¼š${maxStreak}<br>
      ğŸ’€ æœ€é«˜é€£æ•—ç´€éŒ„ï¼š${maxLoseStreak}
    `;
    const final = document.getElementById("finalResult");
    final.innerHTML = resultHTML;
    final.classList.remove("hidden");
    document.getElementById("setup").classList.remove("hidden");
  }
</script>
